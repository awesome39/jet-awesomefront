include mixins

doctype html
html(lang='ru', ng-app='awesomeFront', ng-controller='AppCtrl')


    head
        block head
            meta(charset='utf-8')
            title(ng-bind="app.title") JET ENGINE -- A NodeJS CMF...

            block head-links
                link(rel='stylesheet', href='/styles/awesome.css')
                link(rel='stylesheet', href='/styles/awesome-navs.css')
                link(rel='stylesheet', href='/styles/awesome-tabs.css')
                link(rel='stylesheet', href='/styles/awesome-forms.css')
                link(rel='stylesheet', href='/styles/awesome-dialogs.css')
                link(rel='stylesheet', href='/styles/jet.css')


            block head-scripts
                script(src='/scripts/libs/jquery/jquery.min.js')
                script(src='/scripts/libs/angular/angular.min.js')
                script(src='/scripts/libs/angular/angular-animate.min.js')
                script(src='/scripts/libs/angular/angular-resource.min.js')
                script(src='/scripts/libs/angular/angular-route.min.js')
                script(src='/scripts/awesome.js')

                script
                    :coffee



                        app= angular.module 'layout', []

                        app.constant 'version', '0.4.7'
                        app.constant 'path', ''
                        app.constant 'debug', console



                        app.factory 'User', ($resource) ->
                            $resource '/api/v1/user/:action', {},
                                login:
                                    method: 'post'
                                    params:
                                        action: 'login'

                                logout:
                                    method: 'get'
                                    params:
                                        action: 'logout'

                                sighup:
                                    method: 'post'
                                    params:
                                        action: 'sighup'



                        app.controller 'AppHeadCtrl', ($rootScope, $scope, User, $window) ->
                            $scope.logout= ->
                                User.logout ->
                                    $window.location.href= '/welcome/'
                                    $scope.notify 'done', 'logout'
                                , (err) ->
                                    $scope.notify 'error', err





    body(ng-controller='ViewCtrl'): block body
        .b-app
            header.b-app--head(ng-controller="AppHeadCtrl"): block app-head

                .navbar.navbar-static-top

                    a.navbar-brand(ng-href="{{app.prefix}}/")
                        span jet engine
                        sup  {{app.version}}

                    .nav-collapse

                        ul.nav.navbar-nav.pull-left

                            li: a(href="{{app.prefix}}/design")
                                u Design

                            li: a(ng-href="{{app.prefix}}/develop")
                                u Develop

                            li: a(ng-href="{{app.prefix}}/apps")
                                u Applications


                        if (!user || user.name == 'anonymous')
                            ul.nav.navbar-nav.pull-right

                                li: a(ng-href="{{app.prefix}}/login")
                                    u Sign In

                                li: a(ng-href="{{app.prefix}}/signup")
                                    u Register


                        else
                            ul.nav.navbar-nav.pull-right

                                li: a(href='/project/')
                                    u Project

                                li: a(href='/engine/')
                                    u Engine

                                li.dropdown
                                    a
                                        strong= user.name
                                        i.caret
                                    menu.nav.nav-list.dropdown-menu
                                        li: a(ng-click="logout()") Logout




            main.b-app--body: .row
                style
                    :less
                        .layout-landing {
                            margin: 10% 15%;
                        }

                .b-app--main: block app-main




            menu.b-app--notifications(ng-if="app.notify.notifications.length")
                .b-app--notification(ng-repeat="notification in app.notify.notifications")
                    p.note(ng-if="'error'==notification.type") {{notification}}

            section.b-app--demo  

            footer.b-app--foot
                .navbar
                    a.navbar-brand(ng-class="{active:'index'==app.route.name}", ng-href="{{app.prefix}}/")
                        span jet engine
                        sup  {{app.version}}
