###
Модель
###
module.exports= class Model

    @Property: require './Property'

    @ValidateError: class ValidateError
        constructor: (@errors, @message='Invalid') ->

    @properties: {}



    constructor: (data) ->
        @init data


    init: (data) ->
        for p in Object.keys @constructor.properties
            @[p]= data[p]



    @validate: (data, done) ->
        valid= true

        values= {}
        errors= {}

        for p in Object.keys @properties
            property= @properties[p]
            property= new @Property property if not (property instanceof @Property)

            try
                values[p]= property.validate data[p]
            catch err
                throw err if not (err instanceof @Property.ValidateError)
                valid= false
                errors[p]= err

        err= if valid then null else new @ValidateError errors

        if not done
            throw err if err
            return values

        return done err, values
